<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>ç©å®¶é–ƒé¿ç‡è¨ˆç®—æ©Ÿ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>ğŸ›¡ï¸ ç©å®¶é–ƒé¿ç‡è¨ˆç®—æ©Ÿ</h2>

    <div class="input-group">
      <label for="playerAvoid">è§’è‰²è¿´é¿ç‡ï¼š</label>
      <input type="number" id="playerAvoid" value="2025" />
    </div>

    <div class="input-group">
      <label for="playerLevel">è§’è‰²ç­‰ç´šï¼š</label>
      <input type="number" id="playerLevel" value="50" />
    </div>

    <div class="input-group">
      <label for="monsterSelect">é¸æ“‡æ€ªç‰©ï¼š</label>
      <select id="monsterSelect">
        <option value="">è«‹é¸æ“‡æ€ªç‰©</option>
      </select>
    </div>

    <div class="input-group">
      <label for="monsterHit">æ€ªç‰©å‘½ä¸­å€¼ï¼š</label>
      <input type="number" id="monsterHit" placeholder="æˆ–æ‰‹å‹•è¼¸å…¥" />
    </div>

    <div class="input-group">
      <label for="monsterLevel">æ€ªç‰©ç­‰ç´šï¼š</label>
      <input type="number" id="monsterLevel" value="50" />
    </div>

    <button onclick="calculateEvasion()">è¨ˆç®—è¿´é¿æ©Ÿç‡</button>

    <div class="result" id="output"></div>
  </div>

  <script>
    // è¼‰å…¥æ€ªç‰©è³‡æ–™ JSONï¼Œå¡«å……ä¸‹æ‹‰é¸å–®
    fetch("monsters.json")
      .then((res) => res.json())
      .then((monsters) => {
        const sel = document.getElementById("monsterSelect");
        monsters.forEach((m) => {
          const opt = document.createElement("option");
          opt.value = m.hit;
          opt.text = `${m.name}ï¼ˆå‘½ä¸­ ${m.hit}ï¼Œé–ƒé¿ ${m.avoid}ï¼‰`;
          opt.dataset.avoid = m.avoid;
          opt.dataset.level = m.level || 50;
          sel.appendChild(opt);
        });

        sel.addEventListener("change", (e) => {
          const hit = e.target.value;
          const selectedOption = e.target.selectedOptions[0];
          document.getElementById("monsterHit").value = hit || "";
          document.getElementById("monsterLevel").value =
            selectedOption.dataset.level || 50;
        });
      });

    function calculateEvasion() {
      const playerAvoid = parseInt(document.getElementById("playerAvoid").value);
      const monsterHit = parseInt(document.getElementById("monsterHit").value);
      const monsterLevel = parseInt(document.getElementById("monsterLevel").value);
      const playerLevel = parseInt(document.getElementById("playerLevel").value);

      if (
        isNaN(playerAvoid) ||
        isNaN(monsterHit) ||
        isNaN(monsterLevel) ||
        isNaN(playerLevel)
      ) {
        document.getElementById("output").innerText = "è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼";
        return;
      }

      let sqrtAvoid = Math.floor(Math.sqrt(playerAvoid));
      let sqrtHit = Math.floor(Math.sqrt(monsterHit));

      let evasionRate = sqrtAvoid - sqrtHit;

      if (monsterLevel > playerLevel) {
        evasionRate -= (monsterLevel - playerLevel) * 3;
      }

      if (evasionRate < 0) evasionRate = 0;
      if (evasionRate > 100) evasionRate = 100;

      document.getElementById("output").innerText =
        `âœ¨ ç©å®¶æœ‰ ${evasionRate}% æ©Ÿç‡é–ƒé¿æ€ªç‰©æ”»æ“Š`;
    }
  </script>
</body>
</html>
